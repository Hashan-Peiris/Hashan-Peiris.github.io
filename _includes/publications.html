<section class="section has-background-white-ter" id="publications">
  <div class="container">
    <h2 class="title is-size-3 has-text-centered">Publications & Presentations</h2>
    {% assign sorted_pubs = site.data.publications | sort: 'year' | reverse %}
    <div class="content" style="max-width: 900px; margin: auto;">
      {% for pub in sorted_pubs %}
        <article class="box mb-4">
          <div class="level">
            <div class="level-left">
              <div>
                <h3 class="title is-4">{{ pub.title }}</h3>
                <p class="is-size-6 has-text-grey">{{ pub.authors }}</p>
                <p class="is-size-6 has-text-weight-semibold">{{ pub.venue }} &bull; {{ pub.year }}</p>
                {% if pub.summary %}
                  <p class="mt-2">{{ pub.summary }}</p>
                {% endif %}
                {% if pub.tags %}
                  <div class="tags mt-2">
                    {% for tag in pub.tags %}
                      <span class="tag is-light">{{ tag }}</span>
                    {% endfor %}
                  </div>
                {% endif %}
                <div class="buttons mt-3">
                  {% if pub.links.url %}
                    <a class="button is-link is-light" href="{{ pub.links.url }}" target="_blank" rel="noopener">View</a>
                  {% endif %}
                  {% if pub.links.pdf %}
                    <a class="button is-link is-outlined" href="{{ pub.links.pdf }}" target="_blank" rel="noopener">PDF</a>
                  {% endif %}
                  <button class="button is-small is-dark" onclick="toggleBibtex(this)" data-target="bib-{{ forloop.index }}">BibTeX</button>
                </div>
              </div>
            </div>
            {% if pub.image %}
              <div class="level-right">
                <figure class="image" style="max-width: 220px;">
                  <img src="{{ pub.image }}" alt="{{ pub.title }} graphic">
                </figure>
              </div>
            {% endif %}
          </div>
          {% if pub.bibtex %}
            <pre class="is-size-7 bibtex" id="bib-{{ forloop.index }}" style="display:none;">{{ pub.bibtex | escape }}</pre>
          {% endif %}
        </article>
      {% endfor %}
      <div class="has-text-centered"><span class="is-size-6 has-text-grey">Full list on request â€¢ <a href="{{site.baseurl}}/assets/Resume_Hashan_Peiris_v5_INDUSTRY.pdf" target="_blank">Download CV</a></span></div>
    </div>
  </div>
</section>

<script>
  function toggleBibtex(btn) {
    const targetId = btn.getAttribute('data-target');
    const panel = document.getElementById(targetId);
    if (!panel) return;
    const isHidden = panel.style.display === 'none' || panel.style.display === '';
    panel.style.display = isHidden ? 'block' : 'none';
  }
</script>
